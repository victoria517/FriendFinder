<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Survey</title>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
</head>

<body>
<div class="container">

    <h1>Take the Survey</h1>
    <hr>
    <form role="form" id="survey">
        <h2>Your Information</h2>
        <div class="form-group">
            <label for="usr">Name: (Required)</label>
            <input type="text" class="form-control" id="name">
        </div>
        <div class="form-group">
            <label for="pic">URL for Photo: (Required)</label>
            <input type="text" class="form-control" id="pic">
        </div>
        <hr>
        <h2>Rate how strongly you agree with the following statements:</h2>

        <div class="row col-lg-12">
            <h3>Question 1</h3>
            <h4>I think I have more confidence than most people.</h4>
            <div class="form-group col-xs-3">
                <select class="form-control" id="quest1">
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
        </div>

        <div class="row col-lg-12">
            <h3>Question 2</h3>
            <h4>Overall, I would consider myself very happy.</h4>
            <div class="form-group col-xs-3">
                <select class="form-control" id="quest2">
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
        </div>

        <div class="row col-lg-12">
            <h3>Question 3</h3>
            <h4>I like to try new and different things.</h4>
            <div class="form-group col-xs-3">
                <select class="form-control" id="quest3">
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
        </div>

        <div class="row col-lg-12">
            <h3>Question 4</h3>
            <h4>I would rather spend a quiet evening at home than go out to a party.</h4>
            <div class="form-group col-xs-3">
                <select class="form-control" id="quest4">
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
        </div>

        <div class="row col-lg-12">
            <h3>Question 5</h3>
            <h4>My social status is an important part of my life.</h4>
            <div class="form-group col-xs-3">
                <select class="form-control" id="quest5">
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
        </div>

        <div class="row col-lg-12">
            <h3>Question 6</h3>
            <h4>I find it difficult to speak in front of a group.</h4>
            <div class="form-group col-xs-3">
                <select class="form-control" id="quest6">
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
        </div>

        <div class="row col-lg-12">
            <h3>Question 7</h3>
            <h4>I would rather not try something that I'm not good at.</h4>
            <div class="form-group col-xs-3">
                <select class="form-control" id="quest7">
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
        </div>

        <div class="row col-lg-12">
            <h3>Question 8</h3>
            <h4>I believe that everything happens for a reason.</h4>
            <div class="form-group col-xs-3">
                <select class="form-control" id="quest8">
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
        </div>

        <div class="row col-lg-12">
            <h3>Question 9</h3>
            <h4>I like to enjoy life and do not worry about the future.</h4>
            <div class="form-group col-xs-3">
                <select class="form-control" id="quest9">
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
        </div>


        <div class="row col-lg-12">
            <h3>Question 10</h3>
            <h4>I am an optimist.</h4>
            <div class="form-group col-xs-3">
                <select class="form-control" id="quest10">
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
        </div>
        
        <button type="button" class="btn btn-success btn-block" id="submit">Submit</button>

    </form>

<div class="modal fade" id="friend-modal" role="dialog">
<div class="modal-dialog">

<div class="modal-content">
    <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">&times;</button>
    <h4 class="modal-title"></h4>
    </div>
    <div class="modal-body">
    </div>
    <div class="modal-footer">
    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
    </div>
</div>

</div>
</div>
<div class="footer">
<br>
<br>
</div>
</div>
<script type="text/javascript">
    
$('#submit').on("click", function(){
    var validEntry;
    if($("#name").val().trim() === ''){
        alert('Please enter a name');
    }
    else if($("#pic").val().trim() === ''){
        alert('Please enter a link to photo');
    }
    else{
        var answerArray = [];
        for(i=1; i<11; i++){
            answerArray.push(parseInt($('#quest' + i).val().substring(0,1)));
        }
        var newFriend = 
        {
            name: $("#name").val().trim(),
            photo: $("#pic").val().trim(),
            scores: answerArray
        };
        var currentURL = window.location.origin;
        $.post(currentURL + "/api/friends", newFriend,
        function(data){});
        $.ajax({url: currentURL + "/api/friends", method: "GET"}).done(function(res){
                
            var bestFriend;
            var currentBest = 100;
            var differenceArray = [];
            for(i=0; i < res.length - 1; i++){
                for(j=0; j<10; j++){
                    var currentDifference = newFriend.scores[j] - res[i].scores[j];
                    differenceArray.push(Math.abs(currentDifference));
                }
                var difference = differenceArray.reduce(add, 0);
                if(difference < currentBest){
                    bestFriend = res[i];
                    currentBest = difference;
                    differenceArray = [];
                }
                else{
                    differenceArray =[];
                }
                
            }
            var friendName = '<h4>' + bestFriend.name + '<h4>';
            var friendPic = '<img width="300px" src=' + bestFriend.photo + '>';
            $('#friend-modal').modal('show');
            $('#friend-modal h4').html(friendName);
            $('.modal-body').html(friendPic);
            $('#survey')[0].reset();
            
        });
    }
return false;
});
function add(a, b){
return a+b;
};
</script>
</body>